enum EtatCommande {
    waiting
    payed
    collected
}

model Product {
  id_product     Int       @id @default(autoincrement())
  name           String?   @db.VarChar(255)
  description    String?   @db.Text
  price          Decimal?  @db.Decimal(15, 2)
  image          String?   @db.VarChar(255)

  modified_at    DateTime? @updatedAt @db.DateTime(0)
  created_at     DateTime? @default(now()) @db.DateTime(0)

  id_prestataire Int

  prestataire     Prestataire     @relation(fields: [id_prestataire], references: [id_prestataire])
  lignesPanier    LignePanier[]
  stock           Stock[]
  lignesCommande LigneCommande[]

  @@index([id_prestataire])
  @@map("products")
}

model Commande {
  id_commande      Int       @id @default(autoincrement())
  date_commande    DateTime? @db.DateTime(0)
  date_collect     DateTime? @db.DateTime(0)
  total_price      Decimal?  @db.Decimal(15, 2)

  created_at DateTime? @default(now()) @db.DateTime(0)
  updated_at DateTime? @updatedAt @db.DateTime(0)

  id_user          Int
  etat_commande    EtatCommande @default(waiting)

  user           User          @relation(fields: [id_user], references: [id_user])
  lignesCommande LigneCommande[]

  @@index([id_user])
  @@map("commande")
}

model LignePanier {
  id_product Int
  id_user    Int
  quantite   Int?
  price      Decimal? @db.Decimal(15, 2)

  created_at DateTime? @default(now()) @db.DateTime(0)
  updated_at DateTime? @updatedAt @db.DateTime(0)

  product Product @relation(fields: [id_product], references: [id_product])
  user    User    @relation(fields: [id_user], references: [id_user])

  @@id([id_product, id_user])
  @@index([id_user])
  @@map("ligne_panier")
}

model Stock {
  id_product Int
  id_service Int
  stock      Int?
  
  created_at DateTime? @default(now()) @db.DateTime(0)
  updated_at DateTime? @updatedAt @db.DateTime(0)

  product Product @relation(fields: [id_product], references: [id_product])
  sevice  Sevice  @relation(fields: [id_service], references: [id_service])

  @@id([id_product, id_service])
  @@index([id_service])
  @@map("stock")
}

model LigneCommande {
  id_product  Int
  id_commande Int
  quantite    Int?
  price       Decimal? @db.Decimal(15, 2) 

  created_at DateTime? @default(now()) @db.DateTime(0)
  updated_at DateTime? @updatedAt @db.DateTime(0)

  product  Product  @relation(fields: [id_product], references: [id_product])
  commande Commande @relation(fields: [id_commande], references: [id_commande])

  @@id([id_product, id_commande]) 
  @@index([id_commande])
  @@map("ligne_commande")
}
