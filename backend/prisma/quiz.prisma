// Quiz models for the quiz/QCM system

model Quiz {
  id_quiz     Int      @id @default(autoincrement())
  title       String   @db.VarChar(255)
  description String?  @db.Text
  image_url   String?  @db.VarChar(255)
  is_active   Boolean  @default(true)
  
  created_at  DateTime @default(now()) @db.DateTime(0)
  updated_at  DateTime @updatedAt @db.DateTime(0)
  
  id_location    Int
  id_creator     Int
  
  location       Location          @relation(fields: [id_location], references: [id_location])
  creator        User              @relation("QuizCreator", fields: [id_creator], references: [id_user])
  questions      QuizQuestion[]
  attempts       UserQuizAttempt[]
  
  @@index([id_location])
  @@index([id_creator])
  @@map("quizzes")
}

model QuizQuestion {
  id_question Int      @id @default(autoincrement())
  content     String   @db.Text  // HTML content from TipTap editor
  image_url   String?  @db.VarChar(255)
  order_index Int      @default(0)
  
  created_at  DateTime @default(now()) @db.DateTime(0)
  updated_at  DateTime @updatedAt @db.DateTime(0)
  
  id_quiz     Int
  
  quiz        Quiz          @relation(fields: [id_quiz], references: [id_quiz], onDelete: Cascade)
  answers     QuizAnswer[]
  user_answers UserQuizAnswer[]
  
  @@index([id_quiz])
  @@map("quiz_questions")
}

model QuizAnswer {
  id_answer   Int      @id @default(autoincrement())
  content     String   @db.VarChar(500)
  is_correct  Boolean  @default(false)
  order_index Int      @default(0)
  
  created_at  DateTime @default(now()) @db.DateTime(0)
  updated_at  DateTime @updatedAt @db.DateTime(0)
  
  id_question Int
  
  question    QuizQuestion   @relation(fields: [id_question], references: [id_question], onDelete: Cascade)
  user_answers UserQuizAnswer[]
  
  @@index([id_question])
  @@map("quiz_answers")
}

model UserQuizAttempt {
  id_attempt     Int      @id @default(autoincrement())
  score          Int      @default(0)
  total_questions Int     @default(0)
  completed_at   DateTime? @db.DateTime(0)
  
  created_at     DateTime @default(now()) @db.DateTime(0)
  updated_at     DateTime @updatedAt @db.DateTime(0)
  
  id_user        Int
  id_quiz        Int
  
  user           User     @relation(fields: [id_user], references: [id_user])
  quiz           Quiz     @relation(fields: [id_quiz], references: [id_quiz], onDelete: Cascade)
  answers        UserQuizAnswer[]
  
  @@index([id_user])
  @@index([id_quiz])
  @@map("user_quiz_attempts")
}

model UserQuizAnswer {
  id_user_answer Int      @id @default(autoincrement())
  is_correct     Boolean  @default(false)
  
  created_at     DateTime @default(now()) @db.DateTime(0)
  
  id_attempt     Int
  id_question    Int
  id_answer      Int
  
  attempt        UserQuizAttempt @relation(fields: [id_attempt], references: [id_attempt], onDelete: Cascade)
  question       QuizQuestion    @relation(fields: [id_question], references: [id_question], onDelete: Cascade)
  answer         QuizAnswer      @relation(fields: [id_answer], references: [id_answer], onDelete: Cascade)
  
  @@index([id_attempt])
  @@index([id_question])
  @@index([id_answer])
  @@map("user_quiz_answers")
}
