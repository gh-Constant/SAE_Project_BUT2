openapi: 3.0.3

info:
  title: SAE Project BUT2 API
  description: |
    API REST pour notre application web "Les Terres Du Lions".

    ## Fonctionnalités
    - Authentification et gestion des utilisateurs avec (JWT)
    - Gestion des locations (points d'intérêt)
    - Catalogue de produits 
    - Événements et réservations
    - Système de quêtes gamifié
    - Blog et articles
    - QR Codes
    
    ## Authentification
    Les routes protégées nécessitent un token JWT dans le header `Authorization: Bearer <token>`.

tags:
  - name: Auth
    description: Authentification et gestion de session
  - name: Users
    description: Gestion des utilisateurs (Admin)
  - name: Locations
    description: Points d'intérêt et établissements
  - name: Products
    description: Catalogue de produits
  - name: Events
    description: Événements et réservations
  - name: Quests
    description: Système de quêtes gamifié
  - name: Blogs
    description: Articles et contenus
  - name: Orders
    description: Commandes et panier
  - name: QRCode
    description: Génération et scan de QR codes
  - name: System
    description: Health check et configuration
  - name: Contact
    description: Formulaire de contact et messages
  - name: Messaging
    description: Messagerie privée entre utilisateurs
  - name: Quizzes
    description: Gestion des quiz et tentatives
  - name: Upload
    description: Upload de fichiers

paths:
  # ========== AUTH ===================
  /auth/login:
    post:
      tags: [Auth]
      summary: Authentifier un utilisateur
      description: Authentifie un utilisateur avec email et mot de passe, retourne un token JWT.
      operationId: login
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginInput'
            example:
              email: user@example.com
              password: MonmotDepasse898
      responses:
        '200':
          description: Authentification réussie
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoginResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /auth/register:
    post:
      tags: [Auth]
      summary: Inscrire un nouvel utilisateur
      description: Crée un nouveau compte utilisateur.
      operationId: register
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserInput'
            example:
              firstName: Jean
              lastName: Dupont
              email: jean.dupont@example.com
              password: BonneAnnee2026!
              role: aventurier
              avatarUrl: /avatars/default.png
              avatarType: gallery
      responses:
        '201':
          description: Utilisateur créé avec succès
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '400':
          $ref: '#/components/responses/BadRequest'

  /auth/me:
    get:
      tags: [Auth]
      summary: Récupérer les informations de l'utilisateur connecté
      description: Retourne les informations du profil de l'utilisateur authentifié.
      operationId: getMe
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Informations utilisateur récupérées
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  /auth/role:
    get:
      tags: [Auth]
      summary: Récupérer le rôle de l'utilisateur connecté
      operationId: getMyRole
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Rôle récupéré
          content:
            application/json:
              schema:
                type: object
                properties:
                  role:
                    type: string
                    enum: [admin, aventurier, prestataire]
                    example: aventurier
        '401':
          $ref: '#/components/responses/Unauthorized'

  /auth/profile:
    put:
      tags: [Auth]
      summary: Mettre à jour le profil utilisateur
      description: Permet de modifier le profil de l'utilisateur connecté.
      operationId: updateMe
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ProfileUpdate'
      responses:
        '200':
          description: Profil mis à jour
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'

  # ========== USERS ==========
  /users:
    get:
      tags: [Users]
      summary: Lister tous les utilisateurs
      description: Retourne la liste de tous les utilisateurs. Réservé aux administrateurs.
      operationId: getAllUsers
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Liste des utilisateurs
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/User'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'

  /users/{id}/verify:
    post:
      tags: [Users]
      summary: Vérifier un utilisateur
      description: Marque un utilisateur comme vérifié. Réservé aux administrateurs.
      operationId: verifyUser
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/UserId'
      responses:
        '200':
          description: Utilisateur vérifié
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

  /users/{id}:
    delete:
      tags: [Users]
      summary: Supprimer un utilisateur
      description: Supprime un utilisateur du système. Réservé aux administrateurs.
      operationId: deleteUser
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/UserId'
      responses:
        '200':
          description: Utilisateur supprimé
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Utilisateur supprimé avec succès 
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

  # ========== LOCATIONS ==========
  /locations:
    get:
      tags: [Locations]
      summary: Lister toutes les locations
      description: Retourne la liste de tous les points d'intérêt avec leurs prestataires.
      operationId: getAllLocations
      responses:
        '200':
          description: Liste des locations
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Location'
        '500':
          $ref: '#/components/responses/ServerError'

  /locations/{id}:
    get:
      tags: [Locations]
      summary: Récupérer une location par ID
      operationId: getLocationById
      parameters:
        - $ref: '#/components/parameters/LocationId'
      responses:
        '200':
          description: Location trouvée
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Location'
        '404':
          $ref: '#/components/responses/NotFound'
    patch:
      tags: [Locations]
      summary: Mettre à jour une location
      description: Met à jour les informations d'une location. Nécessite authentification et disponibilité.
      operationId: updateLocation
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/LocationId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LocationUpdate'
      responses:
        '200':
          description: Location mise à jour
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Location'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  # ========== PRODUCTS ==========
  /products:
    get:
      tags: [Products]
      summary: Lister tous les produits
      description: Retourne la liste des produits avec filtrage et tri optionnels.
      operationId: getAllProducts
      parameters:
        - name: search
          in: query
          description: Recherche par nom
          schema:
            type: string
        - name: minPrice
          in: query
          description: Prix minimum
          schema:
            type: number
        - name: maxPrice
          in: query
          description: Prix maximum
          schema:
            type: number
        - name: stock
          in: query
          description: Filtrer par stock
          schema:
            type: string
            enum: [in-stock, out-of-stock]
        - name: sortBy
          in: query
          description: Tri
          schema:
            type: string
            enum: [price-asc, price-desc, name-asc, name-desc]
        - name: locationId
          in: query
          description: Filtrer par location
          schema:
            type: integer
        - name: prestataireId
          in: query
          description: Filtrer par prestataire
          schema:
            type: integer
      responses:
        '200':
          description: Liste des produits
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Product'
        '500':
          $ref: '#/components/responses/ServerError'
    post:
      tags: [Products]
      summary: Créer un produit
      description: Réservé aux prestataires. Le produit sera lié au prestataire connecté.
      operationId: createProduct
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ProductInput'
      responses:
        '201':
          description: Produit créé
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Product'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'

  /products/{id}:
    get:
      tags: [Products]
      summary: Récupérer un produit par ID
      operationId: getProductById
      parameters:
        - $ref: '#/components/parameters/ProductId'
      responses:
        '200':
          description: Produit trouvé
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Product'
        '404':
          $ref: '#/components/responses/NotFound'
    put:
      tags: [Products]
      summary: Mettre à jour un produit
      description: Réservé au prestataire propriétaire du produit.
      operationId: updateProduct
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/ProductId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ProductInput'
      responses:
        '200':
          description: Produit mis à jour
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Product'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
    delete:
      tags: [Products]
      summary: Supprimer un produit
      description: Réservé au prestataire propriétaire du produit.
      operationId: deleteProduct
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/ProductId'
      responses:
        '200':
          description: Produit supprimé
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Produit supprimé avec succès
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

  # ========== EVENTS ==========
  /events:
    get:
      tags: [Events]
      summary: Lister tous les événements
      operationId: getEvents
      responses:
        '200':
          description: Liste des événements
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Event'
    post:
      tags: [Events]
      summary: Créer un événement
      operationId: createEvent
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/EventInput'
      responses:
        '201':
          description: Événement créé
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Event'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '400':
          $ref: '#/components/responses/BadRequest'

  /events/{id}:
    get:
      tags: [Events]
      summary: Récupérer un événement par ID
      operationId: getEventById
      parameters:
        - $ref: '#/components/parameters/EventId'
      responses:
        '200':
          description: Événement trouvé
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Event'
        '404':
          $ref: '#/components/responses/NotFound'
    put:
      tags: [Events]
      summary: Mettre à jour un événement
      operationId: updateEvent
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/EventId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/EventInput'
      responses:
        '200':
          description: Événement mis à jour
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
    delete:
      tags: [Events]
      summary: Supprimer un événement
      operationId: deleteEvent
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/EventId'
      responses:
        '200':
          description: Événement supprimé
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  /events/book:
    post:
      tags: [Events]
      summary: Réserver un événement
      operationId: bookEvent
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BookingInput'
      responses:
        '201':
          description: Réservation créée
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EventReservation'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /events/user/reservations:
    get:
      tags: [Events]
      summary: Récupérer mes réservations
      operationId: getUserReservations
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Liste des réservations
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/EventReservation'
        '401':
          $ref: '#/components/responses/Unauthorized'

  # ========== QUESTS ==========
  /quests:
    get:
      tags: [Quests]
      summary: Lister toutes les quêtes
      operationId: getAllQuests
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Liste des quêtes
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Quest'
        '401':
          $ref: '#/components/responses/Unauthorized'
    post:
      tags: [Quests]
      summary: Créer une quête
      description: Seul le prestataire de la location peut créer une quête.
      operationId: createQuest
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/QuestInput'
      responses:
        '201':
          description: Quête créée
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Quest'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /quests/statistics:
    get:
      tags: [Quests]
      summary: Statistiques des quêtes
      operationId: getQuestStatistics
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Statistiques récupérées
          content:
            application/json:
              schema:
                type: object
                properties:
                  totalQuests:
                    type: integer
                    example: 25
                  completedQuests:
                    type: integer
                    example: 150
                  activeUsers:
                    type: integer
                    example: 42

  /quests/locations/{locationId}:
    get:
      tags: [Quests]
      summary: Quêtes par location
      operationId: getQuestsByLocation
      parameters:
        - $ref: '#/components/parameters/LocationId'
      responses:
        '200':
          description: Liste des quêtes de cette location
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Quest'

  /quests/my-quests:
    get:
      tags: [Quests]
      summary: Mes quêtes
      operationId: getUserQuests
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Liste de mes quêtes
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/UserQuest'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /quests/{questId}/accept:
    post:
      tags: [Quests]
      summary: Accepter une quête
      operationId: acceptQuest
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/QuestId'
      responses:
        '200':
          description: Quête acceptée
        '401':
          $ref: '#/components/responses/Unauthorized'

  /quests/{questId}/complete:
    post:
      tags: [Quests]
      summary: Compléter une quête
      operationId: completeQuest
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/QuestId'
      responses:
        '200':
          description: Quête complétée
        '401':
          $ref: '#/components/responses/Unauthorized'

  /quests/{questId}/cancel:
    post:
      tags: [Quests]
      summary: Annuler une quête
      operationId: cancelQuest
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/QuestId'
      responses:
        '200':
          description: Quête annulée
        '401':
          $ref: '#/components/responses/Unauthorized'

  /quests/{questId}:
    put:
      tags: [Quests]
      summary: Modifier une quête
      operationId: updateQuest
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/QuestId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/QuestInput'
      responses:
        '200':
          description: Quête mise à jour
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Quest'
        '401':
          $ref: '#/components/responses/Unauthorized'
    delete:
      tags: [Quests]
      summary: Supprimer une quête
      operationId: deleteQuest
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/QuestId'
      responses:
        '200':
          description: Quête supprimée
        '401':
          $ref: '#/components/responses/Unauthorized'

  # ========== BLOGS ==========
  /blogs:
    post:
      tags: [Blogs]
      summary: Créer un article
      description: Création d'article. Seul le prestataire de la location peut poster.
      operationId: createBlog
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BlogInput'
      responses:
        '201':
          description: Article créé
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Blog'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'

  /blogs/locations/{locationId}/blogs:
    get:
      tags: [Blogs]
      summary: Articles par location
      operationId: getBlogsByLocation
      parameters:
        - $ref: '#/components/parameters/LocationId'
      responses:
        '200':
          description: Liste des articles
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Blog'

  /blogs/{id}:
    get:
      tags: [Blogs]
      summary: Récupérer un article par ID
      operationId: getBlog
      parameters:
        - $ref: '#/components/parameters/BlogId'
      responses:
        '200':
          description: Article trouvé
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Blog'
        '404':
          $ref: '#/components/responses/NotFound'
    put:
      tags: [Blogs]
      summary: Modifier un article
      operationId: updateBlog
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/BlogId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BlogInput'
      responses:
        '200':
          description: Article mis à jour
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
    delete:
      tags: [Blogs]
      summary: Supprimer un article
      operationId: deleteBlog
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/BlogId'
      responses:
        '200':
          description: Article supprimé
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'

  # ========== ROLES ==========
  /roles:
    get:
      tags: [System]
      summary: Lister tous les rôles
      operationId: getAllRoles
      responses:
        '200':
          description: Liste des rôles
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    id:
                      type: integer
                    name:
                      type: string

  # ========== HEALTH ==========
  /health:
    get:
      tags: [System]
      summary: Vérifier la santé de l'API
      operationId: getHealth
      responses:
        '200':
          description: API en bonne santé
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: healthy
                  timestamp:
                    type: string
                    format: date-time
                  environment:
                    type: string
                    example: development

  /health/database:
    get:
      tags: [System]
      summary: Vérifier la connexion à la base de données
      operationId: getDatabaseHealth
      responses:
        '200':
          description: Base de données connectée
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: connected
                  responseTime:
                    type: integer
                    example: 15

  # ========== CONTACT ================
  /contact:
    post:
      tags: [Contact]
      summary: Envoyer un message de contact
      operationId: createContactMessage
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ContactMessageInput'
      responses:
        '201':
          description: Message envoyé
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ContactMessage'
        '400':
          $ref: '#/components/responses/BadRequest'

  /contact/location/{id}:
    get:
      tags: [Contact]
      summary: Récupérer les messages de contact pour une location
      operationId: getContactMessages
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/LocationId'
      responses:
        '200':
          description: Liste des messages
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ContactMessage'
        '401':
          $ref: '#/components/responses/Unauthorized'

  # ========== MESSAGING ==============
  /conversations:
    get:
      tags: [Messaging]
      summary: Lister mes conversations
      operationId: getConversations
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Liste des conversations
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Conversation'
    post:
      tags: [Messaging]
      summary: Créer une conversation
      operationId: createConversation
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ConversationInput'
      responses:
        '201':
          description: Conversation créée
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Conversation'

  /conversations/{id}:
    delete:
      tags: [Messaging]
      summary: Supprimer une conversation
      operationId: deleteConversation
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Conversation supprimée

  /conversations/{id}/messages:
    get:
      tags: [Messaging]
      summary: Récupérer les messages d'une conversation
      operationId: getMessages
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Liste des messages
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Message'

  /messages:
    post:
      tags: [Messaging]
      summary: Envoyer un message
      operationId: sendMessage
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MessageInput'
      responses:
        '201':
          description: Message envoyé
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Message'

  # ========== QUIZZES ==============
  /quizzes:
    get:
      tags: [Quizzes]
      summary: Lister les quiz
      operationId: getQuizzes
      responses:
        '200':
          description: Liste des quiz
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Quiz'
    post:
      tags: [Quizzes]
      summary: Créer un quiz
      operationId: createQuiz
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/QuizInput'
      responses:
        '201':
          description: Quiz créé
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Quiz'

  /quizzes/{id}:
    get:
      tags: [Quizzes]
      summary: Récupérer un quiz par ID
      operationId: getQuizById
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Quiz trouvé
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Quiz'
    put:
      tags: [Quizzes]
      summary: Mettre à jour un quiz
      operationId: updateQuiz
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/QuizInput'
      responses:
        '200':
          description: Quiz mis à jour
    delete:
      tags: [Quizzes]
      summary: Supprimer un quiz
      operationId: deleteQuiz
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Quiz supprimé

  /quizzes/{id}/play:
    get:
      tags: [Quizzes]
      summary: Récupérer un quiz pour jouer
      operationId: getQuizForPlay
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Quiz prêt à jouer

  /quizzes/{id}/submit:
    post:
      tags: [Quizzes]
      summary: Soumettre une tentative de quiz
      operationId: submitQuiz
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Tentative enregistrée

  /quizzes/my-attempts:
    get:
      tags: [Quizzes]
      summary: Mes tentatives de quiz
      operationId: getMyAttempts
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Historique des tentatives

  # ========== ORDERS ===============
  /orders:
    post:
      tags: [Orders]
      summary: Créer une commande
      operationId: createOrder
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/OrderInput'
      responses:
        '201':
          description: Commande créée
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Order'

  /orders/{id}/pay:
    put:
      tags: [Orders]
      summary: Payer une commande
      operationId: payOrder
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Commande payée

  # ========== QRCODE ===============
  /qrcode/generate:
    post:
      tags: [QRCode]
      summary: Générer un QR Code
      operationId: generateQR
      security:
        - bearerAuth: []
      responses:
        '200':
          description: QR Code généré

  /qrcode/validate:
    post:
      tags: [QRCode]
      summary: Valider un QR Code
      operationId: validateQR
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Résultat de validation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/QRCodeStatus'

  # ========== UPLOAD ===============
  /upload:
    post:
      tags: [Upload]
      summary: Uploader un fichier
      operationId: uploadFile
      security:
        - bearerAuth: []
      requestBody:
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                file:
                  type: string
                  format: binary
      responses:
        '200':
          description: Fichier uploadé
          content:
            application/json:
              schema:
                type: object
                properties:
                  url:
                    type: string

# ========== COMPONENTS ==========
components:
  securitySchemes:

    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: Token JWT obtenu via /auth/login

  parameters:
    UserId:
      name: id
      in: path
      required: true
      description: Identifiant unique de l'utilisateur
      schema:
        type: integer
        minimum: 1
      example: 1

    LocationId:
      name: id
      in: path
      required: true
      description: Identifiant unique de la location
      schema:
        type: integer
        minimum: 1
      example: 1

    ProductId:
      name: id
      in: path
      required: true
      description: Identifiant unique du produit
      schema:
        type: integer
        minimum: 1
      example: 1

    EventId:
      name: id
      in: path
      required: true
      description: Identifiant unique de l'événement
      schema:
        type: integer
        minimum: 1
      example: 1

    QuestId:
      name: questId
      in: path
      required: true
      description: Identifiant unique de la quête
      schema:
        type: integer
        minimum: 1
      example: 1

    BlogId:
      name: id
      in: path
      required: true
      description: Identifiant unique de l'article
      schema:
        type: integer
        minimum: 1
      example: 1

  schemas:
    # ===== AUTH SCHEMAS =====
    LoginInput:
      type: object
      required: [email, password]
      properties:
        email:
          type: string
          format: email
          example: user@example.com
        password:
          type: string
          format: password
          example: BonneAnne2026!

    LoginResponse:
      type: object
      properties:
        token:
          type: string
          description: JWT token
          example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
        user:
          $ref: '#/components/schemas/User'

    UserInput:
      type: object
      required: [firstName, lastName, email, password, role]
      properties:
        firstName:
          type: string
          minLength: 2
          maxLength: 100
          example: Jean
        lastName:
          type: string
          minLength: 2
          maxLength: 100
          example: Dupont
        email:
          type: string
          format: email
          example: jean.dupont@example.com
        password:
          type: string
          format: password
          minLength: 8
          example: BonneAnnee2026!
        role:
          type: string
          enum: [admin, aventurier, prestataire]
          example: aventurier
        avatarUrl:
          type: string
          example: /avatars/default.png
        avatarType:
          type: string
          enum: [gallery, upload]
          example: gallery

    ProfileUpdate:
      type: object
      properties:
        firstname:
          type: string
          example: Jean
        lastname:
          type: string
          example: Dupont
        email:
          type: string
          format: email
          example: jean.dupont@example.com
        avatarUrl:
          type: string
          example: /avatars/pirate.png
        avatarType:
          type: string
          enum: [gallery, upload]
        birthDate:
          type: string
          format: date
          example: '1990-01-15'
        phone:
          type: string
          example: '+33612345678'
        bio:
          type: string
          maxLength: 500
          example: Aventurier passionné de découvertes

    User:
      type: object
      properties:
        id_user:
          type: integer
          example: 1
        firstname:
          type: string
          example: Jean
        lastname:
          type: string
          example: Dupont
        email:
          type: string
          format: email
          example: jean.dupont@example.com
        role:
          type: string
          enum: [admin, aventurier, prestataire]
          example: aventurier
        avatar_url:
          type: string
          example: /avatars/pirate.png
        avatar_type:
          type: string
          enum: [gallery, upload]
          example: gallery
        level:
          type: integer
          example: 5
        xp:
          type: number
          example: 1250.5
        gold:
          type: integer
          example: 100
        is_verified:
          type: boolean
          example: true
        birth_date:
          type: string
          format: date
          nullable: true
        phone:
          type: string
          nullable: true
        bio:
          type: string
          nullable: true
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    # ===== LOCATION SCHEMAS =====
    Location:
      type: object
      properties:
        id:
          type: integer
          example: 1
        name:
          type: string
          example: Taverne du Dragon
        description:
          type: string
          nullable: true
          example: Une taverne mystérieuse au cœur de la forêt
        static_code:
          type: string
          nullable: true
          example: LOC001
        price:
          type: number
          example: 150.00
        purchased:
          type: boolean
          example: false
        position:
          type: object
          properties:
            lat:
              type: number
              example: 48.8566
            lng:
              type: number
              example: 2.3522
        icon_name:
          type: string
          nullable: true
          example: tavern-icon
        banner_image:
          type: string
          nullable: true
          example: /banners/tavern.jpg
        id_prestataire:
          type: integer
          nullable: true
          example: 5
        id_location_type:
          type: integer
          example: 1
        prestataire:
          type: object
          nullable: true
          properties:
            id_user:
              type: integer
            firstname:
              type: string
            lastname:
              type: string
            avatar_url:
              type: string
            avatar_type:
              type: string

    LocationUpdate:
      type: object
      properties:
        name:
          type: string
        description:
          type: string
        price:
          type: number
        purchased:
          type: boolean
        id_prestataire:
          type: integer
          nullable: true

    # ===== PRODUCT SCHEMAS =====
    Product:
      type: object
      properties:
        id:
          type: integer
          example: 1
        name:
          type: string
          example: Potion de vie
        description:
          type: string
          nullable: true
          example: Restaure 50 points de vie
        price:
          type: number
          example: 25.00
        imageUrl:
          type: string
          nullable: true
          example: /products/potion.png
        stock:
          type: integer
          example: 100
        locationId:
          type: integer
          example: 1
        id_prestataire:
          type: integer
          example: 5

    ProductInput:
      type: object
      required: [name, price, id_prestataire]
      properties:
        name:
          type: string
          example: Potion de vie
        description:
          type: string
          example: Restaure 50 points de vie
        price:
          type: number
          example: 25.00
        imageUrl:
          type: string
          example: /products/potion.png
        id_prestataire:
          type: integer
          example: 5
        locationId:
          type: integer
          example: 1
        stock:
          type: integer
          example: 100

    # ===== EVENT SCHEMAS =====
    Event:
      type: object
      properties:
        id_event:
          type: integer
          example: 1
        title:
          type: string
          example: Festival des Lumières
        description:
          type: string
          nullable: true
          example: Un festival magique illuminant la nuit
        start_time:
          type: string
          format: date-time
          example: '2025-01-15T18:00:00Z'
        end_time:
          type: string
          format: date-time
          example: '2025-01-15T23:00:00Z'
        price:
          type: number
          example: 15.00
        capacity:
          type: integer
          example: 200
        sold:
          type: integer
          example: 45
        id_location:
          type: integer
          example: 1

    EventInput:
      type: object
      required: [title, start_time, end_time, price, capacity, id_location]
      properties:
        title:
          type: string
          example: Festival des Lumières
        description:
          type: string
          example: Un festival magique illuminant la nuit
        start_time:
          type: string
          format: date-time
        end_time:
          type: string
          format: date-time
        price:
          type: number
          example: 15.00
        capacity:
          type: integer
          example: 200
        id_location:
          type: integer
          example: 1

    BookingInput:
      type: object
      required: [id_event, quantity]
      properties:
        id_event:
          type: integer
          example: 1
        quantity:
          type: integer
          minimum: 1
          example: 2

    EventReservation:
      type: object
      properties:
        id_reservation:
          type: integer
          example: 1
        quantity:
          type: integer
          example: 2
        total_price:
          type: number
          example: 30.00
        status:
          type: string
          enum: [PENDING, CONFIRMED, CANCELLED]
          example: CONFIRMED
        created_at:
          type: string
          format: date-time
        id_user:
          type: integer
        id_event:
          type: integer

    # ===== QUEST SCHEMAS =====
    Quest:
      type: object
      properties:
        id_quest:
          type: integer
          example: 1
        title:
          type: string
          example: Trouver le trésor caché
        description:
          type: string
          example: Explorez la forêt pour trouver le coffre mystérieux
        xp_reward:
          type: integer
          example: 150
        id_location:
          type: integer
          example: 1
        created_at:
          type: string
          format: date-time

    QuestInput:
      type: object
      required: [title, xp_reward, id_location]
      properties:
        title:
          type: string
          example: Trouver le trésor caché
        description:
          type: string
          example: Explorez la forêt pour trouver le coffre mystérieux
        xp_reward:
          type: integer
          minimum: 1
          example: 150
        id_location:
          type: integer
          example: 1

    UserQuest:
      type: object
      properties:
        id_user:
          type: integer
        id_quest:
          type: integer
        status:
          type: string
          enum: [ACCEPTED, COMPLETED, CANCELLED]
        accepted_at:
          type: string
          format: date-time
        completed_at:
          type: string
          format: date-time
          nullable: true
        quest:
          $ref: '#/components/schemas/Quest'

    # ===== BLOG SCHEMAS =====
    Blog:
      type: object
      properties:
        id_blog:
          type: integer
          example: 1
        title:
          type: string
          example: Découvrez notre nouvelle carte
        content:
          type: string
          example: <p>Nous avons le plaisir de vous annoncer...</p>
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
        id_location:
          type: integer
          example: 1

    BlogInput:
      type: object
      required: [title, content, locationId]
      properties:
        title:
          type: string
          example: Découvrez notre nouvelle carte
        content:
          type: string
          example: <p>Nous avons le plaisir de vous annoncer...</p>
        locationId:
          type: integer
          example: 1

    # ===== ERROR SCHEMAS =====
    Error:
      type: object
      properties:
        error:
          type: string
          example: Une erreur est survenue
        message:
          type: string
          example: Message d'erreur détaillé

    # ===== CONTACT SCHEMAS =====
    ContactMessage:
      type: object
      properties:
        id_contact:
          type: integer
          example: 1
        name:
          type: string
          example: Jean Dupont
        email:
          type: string
          format: email
          example: jean@example.com
        message:
          type: string
          example: Bonjour, j'aimerais savoir...
        id_location:
          type: integer
          example: 1
        created_at:
          type: string
          format: date-time

    ContactMessageInput:
      type: object
      required: [name, email, message, id_location]
      properties:
        name:
          type: string
        email:
          type: string
          format: email
        message:
          type: string
        id_location:
          type: integer

    # ===== MESSAGING SCHEMAS =====
    Conversation:
      type: object
      properties:
        id_conversation:
          type: integer
          example: 1
        id_user:
          type: integer
          example: 1
        id_location:
          type: integer
          example: 5
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
        lastMessage:
          $ref: '#/components/schemas/Message'

    Message:
      type: object
      properties:
        id_message:
          type: integer
          example: 101
        content:
          type: string
          example: Bonjour, est-ce disponible ?
        sender_id:
          type: integer
          example: 1
        created_at:
          type: string
          format: date-time
        read:
          type: boolean
          example: false

    MessageInput:
      type: object
      required: [content, conversationId]
      properties:
        content:
          type: string
        conversationId:
          type: integer

    ConversationInput:
      type: object
      required: [locationId, message]
      properties:
        locationId:
          type: integer
        message:
          type: string

    # ===== QUIZ SCHEMAS =====
    Quiz:
      type: object
      properties:
        id_quiz:
          type: integer
          example: 1
        title:
          type: string
          example: Quiz Histoire Médiévale
        description:
          type: string
        id_location:
          type: integer
        questions:
          type: array
          items:
            $ref: '#/components/schemas/Question'

    QuizInput:
      type: object
      required: [title, id_location, questions]
      properties:
        title:
          type: string
        description:
          type: string
        id_location:
          type: integer
        questions:
          type: array
          items:
            $ref: '#/components/schemas/QuestionInput'

    Question:
      type: object
      properties:
        id_question:
          type: integer
        text:
          type: string
        points:
          type: integer
        answers:
          type: array
          items:
            $ref: '#/components/schemas/Answer'

    QuestionInput:
      type: object
      properties:
        text:
          type: string
        points:
          type: integer
        answers:
          type: array
          items:
            $ref: '#/components/schemas/AnswerInput'

    Answer:
      type: object
      properties:
        id_answer:
          type: integer
        text:
          type: string
        is_correct:
          type: boolean

    AnswerInput:
      type: object
      properties:
        text:
          type: string
        is_correct:
          type: boolean

    # ===== ORDER SCHEMAS =====
    Order:
      type: object
      properties:
        id_order:
          type: integer
        total_price:
          type: number
        status:
          type: string
          enum: [PENDING, PAID, CANCELLED]
        items:
          type: array
          items:
            type: object
            properties:
              id_product:
                type: integer
              quantity:
                type: integer
              price:
                type: number

    OrderInput:
      type: object
      properties:
        items:
          type: array
          items:
            type: object
            required: [productId, quantity]
            properties:
              productId:
                type: integer
              quantity:
                type: integer

    # ===== QRCODE SCHEMAS =====
    QRCodeStatus:
      type: object
      properties:
        status:
          type: string
          enum: [valid, used, expired, invalid]
        data:
          type: object

  responses:
    NotFound:
      description: Ressource non trouvée
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error: Ressource non trouvée

    BadRequest:
      description: Requête invalide
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error: Données de requête invalides

    Unauthorized:
      description: Non authentifié
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error: Non autorisé

    Forbidden:
      description: Accès interdit
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error: Accès interdit - permissions insuffisantes

    ServerError:
      description: Erreur serveur
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error: Erreur serveur interne

